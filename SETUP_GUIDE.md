# 디스코드 알림 설정 가이드 (선택사항)

파티 등록 시 디스코드로 자동 알림을 받으려면 Render.com 환경 변수를 설정하세요.

## 1. 디스코드 웹훅 URL 생성
1. 디스코드 채널 설정 → 연동 → 웹훅
2. 새 웹훅 생성 → URL 복사

## 2. Render.com 환경 변수 설정
1. https://dashboard.render.com 접속
2. `mabinogi-party` 서비스 선택
3. **Environment** 탭 클릭
4. **Add Environment Variable** 클릭
5. 다음 변수 추가:
   - **Key**: `DISCORD_WEBHOOK_URL`
   - **Value**: (복사한 웹훅 URL)
   
   - **Key**: `PARTY_SITE_URL` (선택)
   - **Value**: (사이트 URL, 예: https://your-site.com)

6. **Save Changes** 클릭 (자동 재배포됨)

## 3. 알림 형식
```
새로운 파티 모집 정보가 등록되었습니다.
> 대분류: 레이드
> 콘텐츠: 에이렐
> 난이도: 어려움
> 닉네임: 위비아
> 클래스: 화염술사
> 전투력: 58,282
현재 레이드 에이렐, 어려움 등록 인원: 1명
[파티 모집 사이트 바로가기] https://your-site.com
```

---

# 구글 스프레드시트 연동 설정 가이드

## ⚠️ 중요: 백엔드 서버는 Render.com에 배포되어 있습니다!
- **서버 URL**: https://mabinogi-party.onrender.com
- **로컬 Flask 서버 실행 불필요**
- 이 가이드는 Google Sheets 연동만 다룹니다

자세한 배포 정보는 [README_DEPLOY.md](README_DEPLOY.md)를 참고하세요.

---

## 📋 목차
1. [구글 스프레드시트 생성](#1-구글-스프레드시트-생성)
2. [Google Apps Script 설정](#2-google-apps-script-설정)
3. [웹 앱 배포](#3-웹-앱-배포)
4. [프론트엔드 설정](#4-프론트엔드-설정)
5. [테스트](#5-테스트)
6. [문제 해결](#6-문제-해결)

---

## 1. 구글 스프레드시트 생성

### 1-1. 새 스프레드시트 만들기
1. [Google Sheets](https://sheets.google.com) 접속
2. **빈 스프레드시트** 또는 **+** 버튼 클릭
3. 스프레드시트 이름을 `마비노기 파티모집` 등으로 변경

### 1-2. 스프레드시트 ID 확인
스프레드시트 URL에서 ID 복사:
```
https://docs.google.com/spreadsheets/d/[이_부분이_스프레드시트_ID]/edit
```

예시:
```
https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f7g8h9i0j/edit
```
→ 스프레드시트 ID: `1a2b3c4d5e6f7g8h9i0j`

---

## 2. Google Apps Script 설정

### 2-1. Apps Script 에디터 열기
1. 스프레드시트에서 **확장 프로그램** > **Apps Script** 클릭
2. 새 프로젝트가 열립니다

### 2-2. 코드 붙여넣기
1. 기본 코드(`function myFunction() {}`)를 **모두 삭제**
2. `GoogleAppsScript.gs` 파일의 내용을 **전체 복사**하여 붙여넣기

### 2-3. 스프레드시트 ID 설정
코드 상단의 `SPREADSHEET_ID`를 수정:

```javascript
const SPREADSHEET_ID = '여기에_실제_스프레드시트_ID를_붙여넣으세요';
```

예시:
```javascript
const SPREADSHEET_ID = '1a2b3c4d5e6f7g8h9i0j';
```

### 2-4. 프로젝트 저장
1. 프로젝트 이름을 `파티모집 API`로 변경
2. **💾 저장** 버튼 클릭 (Ctrl+S)

### 2-5. 시트 초기화 (선택사항)
1. 함수 선택 드롭다운에서 `initializeSheet` 선택
2. **▶️ 실행** 버튼 클릭
3. 권한 승인 (처음 실행 시)
   - **권한 검토** 클릭
   - 계정 선택
   - **고급** > **이동(안전하지 않은 페이지로 이동)** 클릭
   - **허용** 클릭

---

## 3. 웹 앱 배포

### 3-1. 배포 설정
1. 우측 상단 **배포** > **새 배포** 클릭
2. **배포 유형 선택** 옆 ⚙️ 아이콘 클릭 > **웹 앱** 선택

### 3-2. 배포 설정
다음과 같이 설정:

- **설명**: `파티모집 API v1` (선택사항)
- **다음 계정으로 실행**: **나**
- **액세스 권한**: **모든 사용자** ⚠️ 중요!

### 3-3. 배포 완료
1. **배포** 버튼 클릭
2. **웹 앱 URL** 복사 (매우 중요!)

URL 형식:
```
https://script.google.com/macros/s/AKfycbz.../exec
```

---

## 4. 프론트엔드 설정

### 4-1. script.js 파일 수정
`script.js` 파일을 열고 상단의 `GOOGLE_SCRIPT_URL` 수정:

```javascript
const GOOGLE_SCRIPT_URL = '여기에_복사한_웹_앱_URL을_붙여넣으세요';
```

예시:
```javascript
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz.../exec';
```

### 4-2. 저장
파일을 저장합니다 (Ctrl+S).

---

## 5. 테스트

### 5-1. 웹페이지 열기
1. `index.html` 파일을 브라우저에서 직접 열기
2. 또는 Python 서버로 로컬 호스팅:
   ```powershell
   cd "d:\마비팟\파티모집\새 폴더"
   python -m http.server 8080
   ```
   그 후 http://localhost:8080 접속

### 5-2. 파티 등록 테스트
1. **파티 모집** 탭 클릭
2. **+ 파티 등록** 버튼 클릭
3. 정보 입력:
   - 콘텐츠 선택
   - 난이도 선택
   - **캐릭터 검색** 버튼으로 캐릭터 정보 입력
4. **등록** 버튼 클릭

### 5-3. 구글 스프레드시트 확인
1. 구글 스프레드시트로 돌아가기
2. `파티모집` 시트 확인
3. 방금 등록한 파티 정보가 표시되어야 함

---

## 6. 문제 해결

### ⚠️ 문제 1: "Google Apps Script URL을 설정해주세요" 알림
**원인**: `script.js`에서 URL을 수정하지 않음

**해결**:
1. `script.js` 파일 열기
2. 상단 `GOOGLE_SCRIPT_URL` 수정
3. 저장 후 페이지 새로고침 (F5)

---

### ⚠️ 문제 2: 파티 등록 시 오류 발생
**원인**: Apps Script 권한 문제 또는 배포 설정 오류

**해결**:
1. Apps Script 에디터로 돌아가기
2. **배포** > **배포 관리** 클릭
3. **액세스 권한**이 **모든 사용자**로 설정되어 있는지 확인
4. 아니면 **수정** > **모든 사용자**로 변경 > **배포** 클릭

---

### ⚠️ 문제 3: 데이터가 로드되지 않음
**원인**: 스프레드시트 ID 오류 또는 시트 이름 불일치

**해결**:
1. Apps Script 코드에서 `SPREADSHEET_ID` 확인
2. 스프레드시트 URL에서 ID가 정확한지 확인
3. 시트 이름이 `파티모집`인지 확인 (또는 코드에서 `SHEET_NAME` 수정)

---

### ⚠️ 문제 4: CORS 오류
**원인**: 브라우저 보안 정책

**해결**:
- Google Apps Script 웹 앱은 CORS를 허용하므로 정상적으로 작동해야 합니다
- 혹시 문제가 있다면 브라우저 콘솔(F12)에서 정확한 오류 메시지 확인

---

### ⚠️ 문제 5: 캐릭터 검색 안 됨
**원인**: Render 서버가 sleep 상태

**해결**:
- 첫 검색 시 30초~1분 소요 (정상)
- 이후 검색은 빠름
- https://mabinogi-party.onrender.com/health 접속해서 서버 깨우기

---

## 📌 중요 참고사항

### 보안
- Google Apps Script 웹 앱은 **누구나 접근 가능**합니다
- 민감한 정보는 저장하지 마세요
- 필요시 추가 인증 로직 구현 권장

### 데이터 구분
- **개인 숙제 기록**: 로컬스토리지 (브라우저에만 저장)
- **파티 모집**: 구글 스프레드시트 (공유 가능)

### 배포 URL 관리
- 웹 앱 URL은 재배포 시에도 동일하게 유지됩니다
- **새 배포** 대신 **배포 관리**에서 기존 배포를 **수정**하면 URL이 변경되지 않습니다

---

## 🎉 설정 완료!

모든 설정이 완료되었습니다. 이제 파티 모집 정보가 구글 스프레드시트에 실시간으로 저장되고, 여러 사용자가 동시에 접근할 수 있습니다!

### 추가 기능 아이디어
- 파티 모집 만료 시간 추가
- 파티원 수 제한 기능
- 댓글/메시지 기능
- 알림 기능
